{% extends "base.html" %}

{% block title %}Disponibilidad de Asientos{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="text-center mb-4">Disponibilidad de Asientos - Vuelo {{ vuelo.id }}</h2>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% for fila, asientos_fila in filas.items %}
        <div class="mb-4">
            <div class="bg-dark text-white px-3 py-2 rounded">
                <h5 class="mb-0">Fila {{ fila }}</h5>
            </div>
            <div class="row g-3 mt-2">
                {% for asiento in asientos_fila %}
                    <div class="col-6 col-md-3 col-lg-2">
                        <div class="card shadow-sm text-center border-0 rounded-3
                            {% if asiento.estado == 'Disponible' %} bg-light {% else %} bg-light-subtle {% endif %}">
                            <div class="card-body p-3">
                                <h5 class="fw-bold">{{ asiento.numero }}</h5>
                                {% if asiento.estado == "Disponible" %}
                                    <span class="badge bg-success mb-2">Disponible</span>
                                    <form method="post" action="{% url 'reservar_asiento' vuelo.id asiento.id %}">
                                        {% csrf_token %}
                                        <label for="pasajero_id_{{ asiento.id }}" class="form-label fw-bold mb-1">Pasajero:</label>
                                        <select id="pasajero_id_{{ asiento.id }}" name="pasajero_id" class="form-select mb-2" required>
                                            <option value="">-- Seleccionar --</option>
                                            {% for pasajero in pasajeros %}
                                                <option value="{{ pasajero.id }}">{{ pasajero.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <button type="submit" class="btn btn-primary btn-sm w-100">Reservar</button>
                                    </form>
                                {% else %}
                                    <span class="badge bg-danger mb-2">Ocupado</span>
                                    <button class="btn btn-secondary btn-sm w-100" disabled>Reservar</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% empty %}
        <p class="text-center">No hay asientos disponibles para este vuelo.</p>
    {% endfor %}
</div>
{% endblock %}
